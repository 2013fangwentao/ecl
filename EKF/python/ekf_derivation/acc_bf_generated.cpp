// Sub Expressions
float S0 = vn - vwn;
float S1 = ve - vwe;
float S2 = S0*q0 + S1*q3 - q2*vd;
float S3 = 2*Kaccx;
float S4 = S0*q1 + S1*q2 + q3*vd;
float S5 = S0*q2 - S1*q1 + q0*vd;
float S6 = -S0*q3 + S1*q0 + q1*vd;
float S7 = powf(q1, 2);
float S8 = powf(q2, 2);
float S9 = powf(q0, 2) - powf(q3, 2);
float S10 = S7 - S8 + S9;
float S11 = Kaccx*S10;
float S12 = q0*q3;
float S13 = q1*q2;
float S14 = S12 + S13;
float S15 = S14*S3;
float S16 = q0*q2 - q1*q3;
float S17 = 2*S14;
float S18 = 2*S16;
float S19 = 2*S4;
float S20 = 2*S2;
float S21 = 2*S5;
float S22 = 2*S6;
float S23 = P(0,3)*S22;
float S24 = P(0,0)*S20 + P(0,1)*S19 - P(0,2)*S21 - P(0,22)*S10 - P(0,23)*S17 + P(0,4)*S10 + P(0,5)*S17 - P(0,6)*S18 + S23;
float S25 = P(5,23)*S17;
float S26 = P(0,23)*S20 + P(1,23)*S19 - P(2,23)*S21 - P(22,23)*S10 - P(23,23)*S17 + P(3,23)*S22 + P(4,23)*S10 - P(6,23)*S18 + S25;
float S27 = powf(Kaccx, 2);
float S28 = S17*S27;
float S29 = P(0,5)*S20 + P(1,5)*S19 - P(2,5)*S21 + P(3,5)*S22 + P(4,5)*S10 - P(5,22)*S10 + P(5,5)*S17 - P(5,6)*S18 - S25;
float S30 = P(0,6)*S20 + P(1,6)*S19 - P(2,6)*S21 + P(3,6)*S22 + P(4,6)*S10 + P(5,6)*S17 - P(6,22)*S10 - P(6,23)*S17 - P(6,6)*S18;
float S31 = P(4,22)*S10;
float S32 = P(0,4)*S20 + P(1,4)*S19 - P(2,4)*S21 + P(3,4)*S22 - P(4,23)*S17 + P(4,4)*S10 + P(4,5)*S17 - P(4,6)*S18 - S31;
float S33 = S10*S27;
float S34 = P(0,22)*S20 + P(1,22)*S19 - P(2,22)*S21 - P(22,22)*S10 - P(22,23)*S17 + P(3,22)*S22 + P(5,22)*S17 - P(6,22)*S18 + S31;
float S35 = P(1,2)*S21;
float S36 = P(0,1)*S20 + P(1,1)*S19 - P(1,22)*S10 - P(1,23)*S17 + P(1,3)*S22 + P(1,4)*S10 + P(1,5)*S17 - P(1,6)*S18 - S35;
float S37 = P(1,2)*S19;
float S38 = P(0,2)*S20 - P(2,2)*S21 - P(2,22)*S10 - P(2,23)*S17 + P(2,3)*S22 + P(2,4)*S10 + P(2,5)*S17 - P(2,6)*S18 + S37;
float S39 = P(0,3)*S20;
float S40 = P(1,3)*S19 - P(2,3)*S21 - P(3,22)*S10 - P(3,23)*S17 + P(3,3)*S22 + P(3,4)*S10 + P(3,5)*S17 - P(3,6)*S18 + S39;
float S41 = Kaccx/(R_ACC - S18*S27*S30 + S19*S27*S36 + S20*S24*S27 - S21*S27*S38 + S22*S27*S40 - S26*S28 + S28*S29 + S32*S33 - S33*S34);
float S42 = S12 - S13;
float S43 = 2*Kaccy;
float S44 = S42*S43;
float S45 = -S7 + S8 + S9;
float S46 = Kaccy*S45;
float S47 = q0*q1 + q2*q3;
float S48 = 2*S47;
float S49 = 2*S42;
float S50 = P(0,0)*S22 + P(0,1)*S21 + P(0,2)*S19 + P(0,22)*S49 - P(0,23)*S45 - P(0,4)*S49 + P(0,5)*S45 + P(0,6)*S48 - S39;
float S51 = powf(Kaccy, 2);
float S52 = P(0,6)*S22 + P(1,6)*S21 + P(2,6)*S19 - P(3,6)*S20 - P(4,6)*S49 + P(5,6)*S45 + P(6,22)*S49 - P(6,23)*S45 + P(6,6)*S48;
float S53 = P(4,22)*S49;
float S54 = P(0,22)*S22 + P(1,22)*S21 + P(2,22)*S19 + P(22,22)*S49 - P(22,23)*S45 - P(3,22)*S20 + P(5,22)*S45 + P(6,22)*S48 - S53;
float S55 = S49*S51;
float S56 = P(0,4)*S22 + P(1,4)*S21 + P(2,4)*S19 - P(3,4)*S20 - P(4,23)*S45 - P(4,4)*S49 + P(4,5)*S45 + P(4,6)*S48 + S53;
float S57 = P(5,23)*S45;
float S58 = P(0,5)*S22 + P(1,5)*S21 + P(2,5)*S19 - P(3,5)*S20 - P(4,5)*S49 + P(5,22)*S49 + P(5,5)*S45 + P(5,6)*S48 - S57;
float S59 = S45*S51;
float S60 = P(0,23)*S22 + P(1,23)*S21 + P(2,23)*S19 + P(22,23)*S49 - P(23,23)*S45 - P(3,23)*S20 - P(4,23)*S49 + P(6,23)*S48 + S57;
float S61 = P(0,2)*S22 + P(2,2)*S19 + P(2,22)*S49 - P(2,23)*S45 - P(2,3)*S20 - P(2,4)*S49 + P(2,5)*S45 + P(2,6)*S48 + S35;
float S62 = P(0,1)*S22 + P(1,1)*S21 + P(1,22)*S49 - P(1,23)*S45 - P(1,3)*S20 - P(1,4)*S49 + P(1,5)*S45 + P(1,6)*S48 + S37;
float S63 = P(1,3)*S21 + P(2,3)*S19 + P(3,22)*S49 - P(3,23)*S45 - P(3,3)*S20 - P(3,4)*S49 + P(3,5)*S45 + P(3,6)*S48 + S23;
float S64 = Kaccy/(R_ACC + S19*S51*S61 - S20*S51*S63 + S21*S51*S62 + S22*S50*S51 + S48*S51*S52 + S54*S55 - S55*S56 + S58*S59 - S59*S60);


// X axis observation Jacobians
H_VEL(0) = -S2*S3;
H_VEL(1) = -S3*S4;
H_VEL(2) = S3*S5;
H_VEL(3) = -S3*S6;
H_VEL(4) = -S11;
H_VEL(5) = -S15;
H_VEL(6) = S16*S3;
H_VEL(7) = 0;
H_VEL(8) = 0;
H_VEL(9) = 0;
H_VEL(10) = 0;
H_VEL(11) = 0;
H_VEL(12) = 0;
H_VEL(13) = 0;
H_VEL(14) = 0;
H_VEL(15) = 0;
H_VEL(16) = 0;
H_VEL(17) = 0;
H_VEL(18) = 0;
H_VEL(19) = 0;
H_VEL(20) = 0;
H_VEL(21) = 0;
H_VEL(22) = S11;
H_VEL(23) = S15;


// X axis Kalman gains
Kfusion(0) = -S24*S41;
Kfusion(1) = -S36*S41;
Kfusion(2) = -S38*S41;
Kfusion(3) = -S40*S41;
Kfusion(4) = -S32*S41;
Kfusion(5) = -S29*S41;
Kfusion(6) = -S30*S41;
Kfusion(7) = -S41*(P(0,7)*S20 + P(1,7)*S19 - P(2,7)*S21 + P(3,7)*S22 + P(4,7)*S10 + P(5,7)*S17 - P(6,7)*S18 - P(7,22)*S10 - P(7,23)*S17);
Kfusion(8) = -S41*(P(0,8)*S20 + P(1,8)*S19 - P(2,8)*S21 + P(3,8)*S22 + P(4,8)*S10 + P(5,8)*S17 - P(6,8)*S18 - P(8,22)*S10 - P(8,23)*S17);
Kfusion(9) = -S41*(P(0,9)*S20 + P(1,9)*S19 - P(2,9)*S21 + P(3,9)*S22 + P(4,9)*S10 + P(5,9)*S17 - P(6,9)*S18 - P(9,22)*S10 - P(9,23)*S17);
Kfusion(10) = -S41*(P(0,10)*S20 + P(1,10)*S19 - P(10,22)*S10 - P(10,23)*S17 - P(2,10)*S21 + P(3,10)*S22 + P(4,10)*S10 + P(5,10)*S17 - P(6,10)*S18);
Kfusion(11) = -S41*(P(0,11)*S20 + P(1,11)*S19 - P(11,22)*S10 - P(11,23)*S17 - P(2,11)*S21 + P(3,11)*S22 + P(4,11)*S10 + P(5,11)*S17 - P(6,11)*S18);
Kfusion(12) = -S41*(P(0,12)*S20 + P(1,12)*S19 - P(12,22)*S10 - P(12,23)*S17 - P(2,12)*S21 + P(3,12)*S22 + P(4,12)*S10 + P(5,12)*S17 - P(6,12)*S18);
Kfusion(13) = -S41*(P(0,13)*S20 + P(1,13)*S19 - P(13,22)*S10 - P(13,23)*S17 - P(2,13)*S21 + P(3,13)*S22 + P(4,13)*S10 + P(5,13)*S17 - P(6,13)*S18);
Kfusion(14) = -S41*(P(0,14)*S20 + P(1,14)*S19 - P(14,22)*S10 - P(14,23)*S17 - P(2,14)*S21 + P(3,14)*S22 + P(4,14)*S10 + P(5,14)*S17 - P(6,14)*S18);
Kfusion(15) = -S41*(P(0,15)*S20 + P(1,15)*S19 - P(15,22)*S10 - P(15,23)*S17 - P(2,15)*S21 + P(3,15)*S22 + P(4,15)*S10 + P(5,15)*S17 - P(6,15)*S18);
Kfusion(16) = -S41*(P(0,16)*S20 + P(1,16)*S19 - P(16,22)*S10 - P(16,23)*S17 - P(2,16)*S21 + P(3,16)*S22 + P(4,16)*S10 + P(5,16)*S17 - P(6,16)*S18);
Kfusion(17) = -S41*(P(0,17)*S20 + P(1,17)*S19 - P(17,22)*S10 - P(17,23)*S17 - P(2,17)*S21 + P(3,17)*S22 + P(4,17)*S10 + P(5,17)*S17 - P(6,17)*S18);
Kfusion(18) = -S41*(P(0,18)*S20 + P(1,18)*S19 - P(18,22)*S10 - P(18,23)*S17 - P(2,18)*S21 + P(3,18)*S22 + P(4,18)*S10 + P(5,18)*S17 - P(6,18)*S18);
Kfusion(19) = -S41*(P(0,19)*S20 + P(1,19)*S19 - P(19,22)*S10 - P(19,23)*S17 - P(2,19)*S21 + P(3,19)*S22 + P(4,19)*S10 + P(5,19)*S17 - P(6,19)*S18);
Kfusion(20) = -S41*(P(0,20)*S20 + P(1,20)*S19 - P(2,20)*S21 - P(20,22)*S10 - P(20,23)*S17 + P(3,20)*S22 + P(4,20)*S10 + P(5,20)*S17 - P(6,20)*S18);
Kfusion(21) = -S41*(P(0,21)*S20 + P(1,21)*S19 - P(2,21)*S21 - P(21,22)*S10 - P(21,23)*S17 + P(3,21)*S22 + P(4,21)*S10 + P(5,21)*S17 - P(6,21)*S18);
Kfusion(22) = -S34*S41;
Kfusion(23) = -S26*S41;


// Y axis observation Jacobians
H_VEL(0) = -Kaccy*S22;
H_VEL(1) = -Kaccy*S21;
H_VEL(2) = -Kaccy*S19;
H_VEL(3) = Kaccy*S20;
H_VEL(4) = S44;
H_VEL(5) = -S46;
H_VEL(6) = -S43*S47;
H_VEL(7) = 0;
H_VEL(8) = 0;
H_VEL(9) = 0;
H_VEL(10) = 0;
H_VEL(11) = 0;
H_VEL(12) = 0;
H_VEL(13) = 0;
H_VEL(14) = 0;
H_VEL(15) = 0;
H_VEL(16) = 0;
H_VEL(17) = 0;
H_VEL(18) = 0;
H_VEL(19) = 0;
H_VEL(20) = 0;
H_VEL(21) = 0;
H_VEL(22) = -S44;
H_VEL(23) = S46;


// XY axis Kalman gains
Kfusion(0) = -S50*S64;
Kfusion(1) = -S62*S64;
Kfusion(2) = -S61*S64;
Kfusion(3) = -S63*S64;
Kfusion(4) = -S56*S64;
Kfusion(5) = -S58*S64;
Kfusion(6) = -S52*S64;
Kfusion(7) = -S64*(P(0,7)*S22 + P(1,7)*S21 + P(2,7)*S19 - P(3,7)*S20 - P(4,7)*S49 + P(5,7)*S45 + P(6,7)*S48 + P(7,22)*S49 - P(7,23)*S45);
Kfusion(8) = -S64*(P(0,8)*S22 + P(1,8)*S21 + P(2,8)*S19 - P(3,8)*S20 - P(4,8)*S49 + P(5,8)*S45 + P(6,8)*S48 + P(8,22)*S49 - P(8,23)*S45);
Kfusion(9) = -S64*(P(0,9)*S22 + P(1,9)*S21 + P(2,9)*S19 - P(3,9)*S20 - P(4,9)*S49 + P(5,9)*S45 + P(6,9)*S48 + P(9,22)*S49 - P(9,23)*S45);
Kfusion(10) = -S64*(P(0,10)*S22 + P(1,10)*S21 + P(10,22)*S49 - P(10,23)*S45 + P(2,10)*S19 - P(3,10)*S20 - P(4,10)*S49 + P(5,10)*S45 + P(6,10)*S48);
Kfusion(11) = -S64*(P(0,11)*S22 + P(1,11)*S21 + P(11,22)*S49 - P(11,23)*S45 + P(2,11)*S19 - P(3,11)*S20 - P(4,11)*S49 + P(5,11)*S45 + P(6,11)*S48);
Kfusion(12) = -S64*(P(0,12)*S22 + P(1,12)*S21 + P(12,22)*S49 - P(12,23)*S45 + P(2,12)*S19 - P(3,12)*S20 - P(4,12)*S49 + P(5,12)*S45 + P(6,12)*S48);
Kfusion(13) = -S64*(P(0,13)*S22 + P(1,13)*S21 + P(13,22)*S49 - P(13,23)*S45 + P(2,13)*S19 - P(3,13)*S20 - P(4,13)*S49 + P(5,13)*S45 + P(6,13)*S48);
Kfusion(14) = -S64*(P(0,14)*S22 + P(1,14)*S21 + P(14,22)*S49 - P(14,23)*S45 + P(2,14)*S19 - P(3,14)*S20 - P(4,14)*S49 + P(5,14)*S45 + P(6,14)*S48);
Kfusion(15) = -S64*(P(0,15)*S22 + P(1,15)*S21 + P(15,22)*S49 - P(15,23)*S45 + P(2,15)*S19 - P(3,15)*S20 - P(4,15)*S49 + P(5,15)*S45 + P(6,15)*S48);
Kfusion(16) = -S64*(P(0,16)*S22 + P(1,16)*S21 + P(16,22)*S49 - P(16,23)*S45 + P(2,16)*S19 - P(3,16)*S20 - P(4,16)*S49 + P(5,16)*S45 + P(6,16)*S48);
Kfusion(17) = -S64*(P(0,17)*S22 + P(1,17)*S21 + P(17,22)*S49 - P(17,23)*S45 + P(2,17)*S19 - P(3,17)*S20 - P(4,17)*S49 + P(5,17)*S45 + P(6,17)*S48);
Kfusion(18) = -S64*(P(0,18)*S22 + P(1,18)*S21 + P(18,22)*S49 - P(18,23)*S45 + P(2,18)*S19 - P(3,18)*S20 - P(4,18)*S49 + P(5,18)*S45 + P(6,18)*S48);
Kfusion(19) = -S64*(P(0,19)*S22 + P(1,19)*S21 + P(19,22)*S49 - P(19,23)*S45 + P(2,19)*S19 - P(3,19)*S20 - P(4,19)*S49 + P(5,19)*S45 + P(6,19)*S48);
Kfusion(20) = -S64*(P(0,20)*S22 + P(1,20)*S21 + P(2,20)*S19 + P(20,22)*S49 - P(20,23)*S45 - P(3,20)*S20 - P(4,20)*S49 + P(5,20)*S45 + P(6,20)*S48);
Kfusion(21) = -S64*(P(0,21)*S22 + P(1,21)*S21 + P(2,21)*S19 + P(21,22)*S49 - P(21,23)*S45 - P(3,21)*S20 - P(4,21)*S49 + P(5,21)*S45 + P(6,21)*S48);
Kfusion(22) = -S54*S64;
Kfusion(23) = -S60*S64;


